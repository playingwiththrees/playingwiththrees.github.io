<!DOCTYPE html>
<html>
<head>
<title>playingwiththrees</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Permissions-Policy" content="encrypted-media=*">
<style>
@font-face {
    font-family: 'Pantasia';
    src: url('pantasia.ttf') format('truetype');
}

body {
    font-family: 'Pantasia', monospace;
    margin: 20px;
}
pre {
    font-family: 'Pantasia', monospace;
}
a {
    touch-action: manipulation;
    font-family: 'Pantasia', monospace;
}
#output {
    margin-top: 10px;
    white-space: pre-wrap;
    font-family: 'Pantasia', monospace;
}
#output img {
    max-width: 100%;
    height: auto;
    margin: 10px 0;
}
#output iframe {
    max-width: 100%;
    margin: 10px 0;
}
#twitch-embed-container {
    position: fixed;
    z-index: 1000;
    display: none;
}
#twitch-embed-container.show {
    display: block;
}
/* Desktop: top right, 40vw, no margins */
@media (min-width: 768px) {
    #twitch-embed-container {
        top: 0;
        right: 0;
        width: 40vw;
        max-width: 600px;
    }
    #twitch-embed-container > div,
    #twitch-embed-container iframe {
        width: 100%;
        aspect-ratio: 16 / 9;
        border: none;
    }
}
/* Mobile: bottom right, larger size, no margins */
@media (max-width: 767px) {
    #twitch-embed-container {
        bottom: 0;
        right: 0;
        width: 85vw;
        max-width: 100%;
    }
    #twitch-embed-container > div,
    #twitch-embed-container iframe {
        width: 100%;
        aspect-ratio: 16 / 9;
        border: none;
    }
}
</style>
<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init zr Wr fi Br Gr ci Nr Hr capture Ui calculateEventProperties Kr register register_once register_for_session unregister unregister_for_session Zr getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey cancelPendingSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Xr Jr createPersonProfile Qr jr ts opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing Vr debug O Yr getPageViewId captureTraceFeedback captureTraceMetric Or".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_1fIR7wOo29c3WrP9Lb5jWcOgI5p1Wymf8BqgprXdFb1', {
        api_host: 'https://us.i.posthog.com',
        defaults: '2025-11-30',
        person_profiles: 'identified_only', // or 'always' to create profiles for anonymous users as well
    })
</script>
</head>
<body>
<pre>
playingwiththrees
b. <a href="#" onclick="reveal('date1'); return false;">041297</a>, <a href="#" onclick="reveal('date2'); return false;">111700</a>

<div id="output"></div>
</pre>

<div id="twitch-embed-container"></div>

<script>
// Text items (60% probability)
const textItems = [
    '•dry-swallowing focus',
    '•some aimed directly at me, some just grazing',
    '•hush held its posture too long—',
    '•slipped',
    '•fractured',
    '•then the cup again',
    '•lips cracked from the idea of salt (said nothing)',
    '•no emblem',
    '•there were no others',
    '•there was no scene',
    '•there was no one else that understood',
    '•beneath that',
    '•like the wrong god said try again',
    '•i still think about that one look',
    '•water balloon drops 96 feet in front of me nearly missing my head in downtown la  on may 21st around 11:13pm',
    '•i\'ll do anything you ask, anything you say',
    '•grey cross inversion besieged upon filth',
    '•the eternally unsatisfied, in sin'
];

// Other items (40% probability)
const otherItems = [
    // YouTube videos
    { type: 'youtube', value: 'Peb9yfcecQU' },
    { type: 'youtube', value: 'OQN9Ect8zwU' },
    { type: 'youtube', value: 'k4eggdXJKvw' },
    { type: 'youtube', value: 'rjxr9hzcPiA' },
    { type: 'youtube', value: 't-ZWrUKY0zs' },
    { type: 'youtube', value: 'lm8W8jMtQyA' },
    { type: 'youtube', value: 'cvrp1kjUCpM' },
    // Vimeo videos
    { type: 'vimeo', value: '47914218' },
    // Coordinates
    { type: 'coords', value: '35.399805,-119.397750', url: 'https://www.google.com/maps/place/35.399805,-119.397750' },
    // URLs
    { type: 'url', value: 'http://myboyfriendcamebackfromth.ewar.ru/', url: 'http://myboyfriendcamebackfromth.ewar.ru/' },
    { type: 'url', value: 'https://www.sigmaequipment.com/equipment/used/ok-international-supercloser-400-stainless-steel-polybag-in-box-decuffer-folder-closer-305886', url: 'https://www.sigmaequipment.com/equipment/used/ok-international-supercloser-400-stainless-steel-polybag-in-box-decuffer-folder-closer-305886' },
    { type: 'url', value: 'https://portalcioranbr.wordpress.com/fortuna-critica/thinking-against-oneself-cioran/', url: 'https://portalcioranbr.wordpress.com/fortuna-critica/thinking-against-oneself-cioran/' },
    // PDFs
    { type: 'pdf', value: 'https://ia600400.us.archive.org/35/items/on-the-heights-of-despair/On%20the%20Heights%20of%20Despair.pdf' },
    // Images
    { type: 'image', value: 'https://64.media.tumblr.com/eae6044db48ec5d46f54f7dff3c45449/b5d94bbd3c0ea515-94/s2048x3072/56e4e99a2ddae6934a140d53a2278f06b7bfd2e4.jpg' },
    { type: 'image', value: 'https://64.media.tumblr.com/629b9693361afb6a885ad86195812ec2/77713d3a0e33dc68-bc/s2048x3072/d4209b226a15e201d7f55ab62e1e9a0cf90555c9.png' },
    { type: 'image', value: 'https://64.media.tumblr.com/64f813b1fd938621d11d10c3b09e2a46/12415dacb0fa297a-9e/s1280x1920/9b7a7271b7e8e08688365e37347f3393d016f429.webp' },
    { type: 'image', value: 'https://64.media.tumblr.com/3e76c0038b2f2afec4816c802396b444/08d337ea92c47b75-54/s1280x1920/17d966d9f1b3f06c2a6839309b9fd6fa17a5ff0d.webp' },
    { type: 'image', value: 'https://64.media.tumblr.com/79bd4ea3090d16117daf3b370de6e8a8/f14c2f10da98d5cd-90/s2048x3072/4aad7cf01589ac6a37ec4a360509a88e28e6cbf4.jpg' },
    { type: 'image', value: 'https://64.media.tumblr.com/f8e385596ea711751e37322479ecf4fd/02eed04eab5a0b84-e2/s2048x3072/a96a41c983aca6c392ec7a4bf6ac5e0ddfc4ab89.jpg' }
];

// Shuffle arrays randomly on page load
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

const shuffledText = shuffleArray(textItems);
const shuffledOther = shuffleArray(otherItems);

// Track which items have been shown
let textIndex = 0;
let otherIndex = 0;

function renderItem(item) {
    const out = document.getElementById('output');
    let html = '';
    
    if (typeof item === 'string') {
        // Text item
        html = item;
    } else {
        // Other item
        switch (item.type) {
            case 'youtube':
                html = `<iframe width="560" height="315" src="https://www.youtube.com/embed/${item.value}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                break;
            case 'vimeo':
                html = `<iframe width="560" height="315" src="https://player.vimeo.com/video/${item.value}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
                break;
            case 'pdf':
                html = `<iframe width="100%" height="600" src="${item.value}" frameborder="0"></iframe>`;
                break;
            case 'coords':
                html = `<a href="${item.url}" target="_blank">(${item.value})</a>`;
                break;
            case 'url':
                html = `<a href="${item.url}" target="_blank">${item.value}</a>`;
                break;
            case 'image':
                html = `<img src="${item.value}" alt="">`;
                break;
        }
    }
    
    if (out.innerHTML) {
        out.innerHTML = html + '<br>' + out.innerHTML;
    } else {
        out.innerHTML = html;
    }
}

function reveal(id) {
    // Determine which category to use (60% text, 40% other)
    const rand = Math.random();
    let item;
    
    if (rand < 0.6) {
        // Text category (60%)
        if (textIndex < shuffledText.length) {
            item = shuffledText[textIndex];
            textIndex++;
        } else if (otherIndex < shuffledOther.length) {
            // Fallback to other if text is exhausted
            item = shuffledOther[otherIndex];
            otherIndex++;
        } else {
            // All items shown, redirect
            window.location.href = 'https://ffm.bio/playingwiththrees';
            return;
        }
    } else {
        // Other category (40%)
        if (otherIndex < shuffledOther.length) {
            item = shuffledOther[otherIndex];
            otherIndex++;
        } else if (textIndex < shuffledText.length) {
            // Fallback to text if other is exhausted
            item = shuffledText[textIndex];
            textIndex++;
        } else {
            // All items shown, redirect
            window.location.href = 'https://ffm.bio/playingwiththrees';
            return;
        }
    }
    
    renderItem(item);
    
    // Check if all items are now depleted after rendering
    if (textIndex >= shuffledText.length && otherIndex >= shuffledOther.length) {
        // Small delay to let the item render, then redirect
        setTimeout(() => {
            window.location.href = 'https://ffm.bio/playingwiththrees';
        }, 500);
    }
}

// Track if player has detected stream as offline (more reliable than API)
let playerDetectedOffline = false;
let twitchPlayer = null;

// Initialize Twitch embed - it will use ONLINE/OFFLINE events to show/hide
function initializeTwitchEmbed() {
    const username = 'cousinmosquito';
    const container = document.getElementById('twitch-embed-container');
    
    // Only create embed if it doesn't exist yet
    if (!twitchPlayer && container.querySelector('div[id^="twitch-player-"]') === null) {
        showTwitchEmbed(username, container);
    }
}

function showTwitchEmbed(username, container) {
    // Twitch's CSP requires the parent to match the actual origin
    // If accessing via 127.0.0.1, we need to use that, but Twitch might not allow it
    // Best solution: access via localhost:8080 instead of 127.0.0.1:8080
    // For now, try using the actual hostname
    let parent = window.location.hostname;
    
    // If it's 127.0.0.1, try using localhost (but this might not work due to CSP)
    // The user should access via localhost:8080 for it to work properly
    if (window.location.hostname === '127.0.0.1') {
        parent = 'localhost'; // Try localhost, but CSP might still block it
    }
    
    // Clear any existing content
    container.innerHTML = '';
    // Don't show yet - wait for ONLINE event
    
    // Use Twitch Player API (correct API per documentation)
    if (window.Twitch && window.Twitch.Player) {
        createTwitchPlayer(username, parent, container);
    } else {
        // Load Twitch player script first (correct URL per documentation)
        const script = document.createElement('script');
        script.src = 'https://player.twitch.tv/js/embed/v1.js';
        script.onload = () => {
            createTwitchPlayer(username, parent, container);
        };
        document.head.appendChild(script);
    }
}

function createTwitchPlayer(username, parent, container) {
    // Create a unique ID for this player
    const playerId = 'twitch-player-' + Date.now();
    container.innerHTML = `<div id="${playerId}"></div>`;
    
    // Use Twitch.Player API as per documentation
    const options = {
        width: '100%',
        height: '100%',
        channel: username,
        parent: [parent], // Array format as per documentation
        autoplay: true, // Defaults to true per docs, but explicit is better
        muted: true // Muted for better autoplay compatibility
    };
    
    const player = new Twitch.Player(playerId, options);
    twitchPlayer = player; // Store player reference
    
    // Start hidden - will show when stream goes online
    container.classList.remove('show');
    playerDetectedOffline = true; // Assume offline until we hear otherwise
    
    // Set muted and try to play when ready
    player.addEventListener(Twitch.Player.READY, () => {
        player.setMuted(true);
    });
    
    // Listen for OFFLINE event - stream went offline
    player.addEventListener(Twitch.Player.OFFLINE, () => {
        playerDetectedOffline = true;
        container.classList.remove('show');
    });
    
    // Listen for ONLINE event - stream came online
    player.addEventListener(Twitch.Player.ONLINE, () => {
        playerDetectedOffline = false; // Clear offline flag
        container.classList.add('show');
        
        // Try to play when stream comes online
        player.setMuted(true);
        const tryPlay = (attempt = 0) => {
            if (attempt < 5) {
                try {
                    const playResult = player.play();
                    if (playResult && typeof playResult.then === 'function') {
                        playResult.then(() => {
                            // Video started playing
                        }).catch(err => {
                            setTimeout(() => tryPlay(attempt + 1), 300);
                        });
                    }
                } catch (err) {
                    // Error calling play()
                }
            }
        };
        setTimeout(() => tryPlay(), 100);
    });
    
    // Also listen for PLAYING event to confirm it started
    player.addEventListener(Twitch.Player.PLAYING, () => {
        // Video is playing
    });
    
    // Listen for PLAYBACK_BLOCKED event
    player.addEventListener(Twitch.Player.PLAYBACK_BLOCKED, () => {
        // Playback was blocked
    });
}


// Initialize Twitch embed on page load - it will automatically show/hide based on ONLINE/OFFLINE events
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeTwitchEmbed);
} else {
    initializeTwitchEmbed();
}
// No need for interval - Twitch player events handle stream status changes automatically
</script>

</body>
</html>

